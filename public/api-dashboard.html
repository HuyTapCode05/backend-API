<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Management Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’¬</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .sidebar {
            width: 250px;
            background: #1a1a1a;
            border-right: 1px solid #2a2a2a;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            position: relative;
            z-index: 100;
        }

        .logo {
            padding: 0 20px 30px;
            font-size: 24px;
            font-weight: bold;
            color: #4a9eff;
            border-bottom: 1px solid #2a2a2a;
            margin-bottom: 20px;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover {
            background: #252525;
        }

        .nav-item.active {
            background: #2a2a2a;
            border-left: 3px solid #4a9eff;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            z-index: 1;
            background: #0f0f0f;
        }

        .header {
            padding: 20px 30px;
            border-bottom: 1px solid #2a2a2a;
            background: #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 30px 40px;
            height: 100%;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 28px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            cursor: default;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent 0%, currentColor 50%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(74, 158, 255, 0.2);
            border-color: currentColor;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-card h3 {
            font-size: 13px;
            color: #888;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 24px;
            opacity: 0.7;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
            line-height: 1;
            transition: all 0.3s;
        }

        .stat-card:hover .value {
            transform: scale(1.05);
        }

        .stat-card-footer {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        .stat-card.total {
            color: #4a9eff;
        }

        .stat-card.total .stat-icon { color: #4a9eff; }

        .stat-card.active {
            color: #ffa500;
        }

        .stat-card.active .stat-icon { color: #ffa500; }

        .stat-card.success {
            color: #4caf50;
        }

        .stat-card.success .stat-icon { color: #4caf50; }

        .stat-card.error {
            color: #f44336;
        }

        .stat-card.error .stat-icon { color: #f44336; }

        .section {
            background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .section:hover {
            border-color: #3a3a3a;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #e0e0e0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '';
            width: 3px;
            height: 20px;
            background: linear-gradient(135deg, #4a9eff 0%, #6bb6ff 100%);
            border-radius: 2px;
        }

        .endpoint-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .endpoint-item {
            background: #252525;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .endpoint-info {
            flex: 1;
        }

        .endpoint-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .method-get { background: #4caf50; color: white; }
        .method-post { background: #2196f3; color: white; }
        .method-put { background: #ff9800; color: white; }
        .method-delete { background: #f44336; color: white; }

        .endpoint-path {
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
        }

        .endpoint-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4a9eff;
            color: white;
        }

        .btn-primary:hover {
            background: #3a8eef;
        }

        .btn-secondary {
            background: #2a2a2a;
            color: #e0e0e0;
            border: 1px solid #3a3a3a;
        }

        .btn-secondary:hover {
            background: #3a3a3a;
        }

        .test-panel {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .test-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-size: 14px;
            color: #888;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            background: #252525;
            border: 1px solid #2a2a2a;
            color: #e0e0e0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .response-area {
            background: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-area pre {
            color: #4caf50;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .response-area.error pre {
            color: #f44336;
        }

        .activity-item {
            padding: 12px;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #4a9eff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-time {
            color: #888;
            font-size: 12px;
        }

        .hidden {
            display: none;
        }

        .page {
            position: relative;
            z-index: 1;
            background: #0f0f0f;
            min-height: 100%;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-success { background: #4caf50; color: white; }
        .status-error { background: #f44336; color: white; }
        .status-pending { background: #ff9800; color: white; }

        .hero-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);
            border: 1px solid #2a2a2a;
            border-radius: 16px;
            padding: 50px 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 158, 255, 0.08) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-section h1 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4a9eff 0%, #6bb6ff 50%, #8cc8ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 3s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .hero-section p {
            font-size: 18px;
            color: #aaa;
            margin-bottom: 35px;
            line-height: 1.8;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .hero-actions .btn {
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .hero-actions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 158, 255, 0.3);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 40px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 32px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.05) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feature-card:hover::before {
            opacity: 1;
        }

        .feature-card:hover {
            border-color: #4a9eff;
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(74, 158, 255, 0.2);
        }

        .feature-card .icon {
            font-size: 40px;
            margin-bottom: 20px;
            display: inline-block;
            transition: transform 0.3s;
        }

        .feature-card:hover .icon {
            transform: scale(1.1) rotate(5deg);
        }

        .feature-card h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: #e0e0e0;
            font-weight: 600;
        }

        .feature-card p {
            font-size: 14px;
            color: #888;
            line-height: 1.6;
        }

        .intro-section {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .intro-section h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #4a9eff;
        }

        .intro-section p {
            color: #aaa;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .intro-section ul {
            color: #aaa;
            line-height: 1.8;
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .intro-section li {
            margin-bottom: 8px;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .tech-badge {
            background: linear-gradient(135deg, #252525 0%, #2a2a2a 100%);
            border: 1px solid #3a3a3a;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: #4a9eff;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tech-badge:hover {
            background: linear-gradient(135deg, #2a2a2a 0%, #303030 100%);
            border-color: #4a9eff;
            transform: translateY(-2px);
        }

        .about-hero {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);
            border: 1px solid #2a2a2a;
            border-radius: 16px;
            padding: 50px 40px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .about-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 158, 255, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .about-hero-content {
            position: relative;
            z-index: 1;
        }

        .about-hero h1 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4a9eff 0%, #6bb6ff 50%, #8cc8ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .about-hero p {
            font-size: 20px;
            color: #aaa;
            line-height: 1.8;
            max-width: 800px;
            margin: 0 auto;
        }

        .feature-section {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .feature-section:hover {
            border-color: #4a9eff;
            box-shadow: 0 4px 20px rgba(74, 158, 255, 0.1);
        }

        .feature-section h2 {
            font-size: 28px;
            margin-bottom: 25px;
            color: #4a9eff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .feature-section h2::before {
            content: '';
            width: 4px;
            height: 28px;
            background: linear-gradient(135deg, #4a9eff 0%, #6bb6ff 100%);
            border-radius: 2px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-item {
            background: #252525;
            border: 1px solid #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .feature-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(135deg, #4a9eff 0%, #6bb6ff 100%);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .feature-item:hover::before {
            transform: scaleY(1);
        }

        .feature-item:hover {
            border-color: #4a9eff;
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.15);
        }

        .feature-item strong {
            color: #4a9eff;
            font-size: 15px;
            display: block;
            margin-bottom: 8px;
        }

        .feature-item span {
            color: #aaa;
            font-size: 14px;
            line-height: 1.6;
        }

        .usage-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .usage-step {
            background: linear-gradient(135deg, #252525 0%, #2a2a2a 100%);
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }

        .usage-step:hover {
            border-color: #4a9eff;
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(74, 158, 255, 0.2);
        }

        .usage-step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4a9eff 0%, #6bb6ff 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin: 0 auto 15px;
        }

        .usage-step h3 {
            color: #e0e0e0;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .usage-step p {
            color: #888;
            font-size: 14px;
            line-height: 1.6;
        }

        .doc-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #252525 100%);
            border: 1px solid #2a2a2a;
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
        }

        .doc-section h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #4a9eff;
        }

        .code-block {
            background: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #4caf50;
            overflow-x: auto;
        }

        .code-block code {
            color: #4caf50;
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: block;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1002;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 10px 12px;
            cursor: pointer;
            color: #e0e0e0;
            font-size: 24px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none;
            }
        }

        .mobile-menu-toggle:hover {
            background: #252525;
        }

        .mobile-menu-toggle:active {
            background: #2a2a2a;
            transform: scale(0.95);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 250px;
            right: 0;
            width: calc(100% - 250px);
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            z-index: 998;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* On desktop, overlay should not interfere */
        @media (min-width: 769px) {
            .sidebar-overlay {
                display: none !important;
            }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            html, body {
                height: auto;
                min-height: 100vh;
            }

            body {
                flex-direction: column;
                overflow-y: visible;
                overflow-x: hidden;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .sidebar-overlay {
                display: block;
                left: 250px;
                width: calc(100% - 250px);
            }

            .sidebar {
                position: fixed !important;
                left: -250px !important;
                top: 0 !important;
                height: 100vh !important;
                width: 250px !important;
                z-index: 1002 !important;
                transition: left 0.3s ease !important;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5) !important;
                background: #1a1a1a !important;
                display: flex !important;
                flex-direction: column !important;
                transform: none !important;
                margin: 0 !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
            }
            
            .sidebar .nav-item {
                pointer-events: auto !important;
                z-index: 1003 !important;
                position: relative;
                cursor: pointer;
            }

            /* Highest specificity possible - ONLY use left, NO margin-left */
            /* Only apply when sidebar has .open class */
            html body .sidebar.open,
            html body .sidebar.open[class],
            html body .sidebar.open[id],
            html body #sidebar.open,
            html body #sidebar.sidebar.open {
                left: 0px !important;
                margin-left: 0px !important;
                margin-right: 0px !important;
                transform: none !important;
            }
            
            /* When sidebar does NOT have .open class, ensure it's hidden */
            html body .sidebar:not(.open),
            html body #sidebar:not(.open) {
                left: -250px !important;
                margin-left: 0px !important;
                margin-right: 0px !important;
                transform: none !important;
            }

            .sidebar.open ~ .sidebar-overlay {
                opacity: 1;
                pointer-events: auto;
            }

            /* Main content should always be visible above overlay */
            .main-content {
                z-index: 1001 !important;
                position: relative;
            }

            .content {
                z-index: 1 !important;
                position: relative;
                background: #0f0f0f;
            }

            .page {
                z-index: 2 !important;
                position: relative;
                background: #0f0f0f;
            }

            .main-content {
                width: 100%;
                margin-left: 0;
                height: auto;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                position: relative;
                z-index: 1;
                background: #0f0f0f;
            }

            .content {
                height: auto;
                min-height: calc(100vh - 60px);
                overflow-y: visible;
                padding-bottom: 40px;
                position: relative;
                z-index: 1;
                background: #0f0f0f;
            }

            .header {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .header h1 {
                font-size: 20px;
            }

            .content {
                padding: 20px 15px;
            }

            .hero-section {
                padding: 30px 20px;
                margin-bottom: 25px;
            }

            .hero-section h1 {
                font-size: 28px;
            }

            .hero-section p {
                font-size: 16px;
            }

            .hero-actions {
                flex-direction: column;
                gap: 10px;
            }

            .hero-actions .btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 25px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-card .value {
                font-size: 28px;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 25px;
                margin-bottom: 20px;
            }

            .feature-card {
                padding: 25px;
            }

            .feature-card .icon {
                font-size: 32px;
            }

            .section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .section h2 {
                font-size: 18px;
            }

            .endpoint-item {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .endpoint-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .endpoint-actions .btn {
                flex: 1;
            }

            .test-form {
                gap: 12px;
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                font-size: 16px; /* Prevent zoom on iOS */
            }

            .about-hero {
                padding: 30px 20px;
            }

            .about-hero h1 {
                font-size: 28px;
            }

            .about-hero p {
                font-size: 16px;
            }

            .feature-section {
                padding: 20px;
            }

            .feature-section h2 {
                font-size: 22px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .usage-steps {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .tech-stack {
                gap: 8px;
            }

            .tech-badge {
                font-size: 11px;
                padding: 6px 12px;
            }

            #current-server {
                font-size: 10px;
                word-break: break-all;
            }

            .header > div {
                flex-wrap: wrap;
                gap: 8px;
            }

            .status-badge {
                font-size: 11px;
                padding: 3px 6px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }

            .code-block {
                padding: 15px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .content {
                padding: 15px 10px;
            }

            .hero-section {
                padding: 25px 15px;
            }

            .hero-section h1 {
                font-size: 24px;
            }

            .stat-card {
                padding: 18px;
            }

            .stat-card .value {
                font-size: 24px;
            }

            .feature-card {
                padding: 20px;
            }

            .section {
                padding: 18px;
            }

            .about-hero h1 {
                font-size: 24px;
            }

            .feature-section h2 {
                font-size: 20px;
            }

            .logo {
                font-size: 20px;
            }

            .nav-item {
                padding: 10px 15px;
                font-size: 14px;
            }
        }

        /* Tablet Styles */
        @media (min-width: 769px) and (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .content {
                padding: 25px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-menu-toggle" onclick="toggleMobileMenu()">â˜°</div>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <div class="sidebar" id="sidebar">
        <div class="logo">ğŸ’¬ Chat API</div>
        <div class="nav-item active" data-page="dashboard">
            <span>ğŸ“Š</span> Dashboard
        </div>
        <div class="nav-item" data-page="about">
            <span>ğŸ“–</span> Giá»›i thiá»‡u
        </div>
        <div class="nav-item" data-page="quicktests">
            <span>âš¡</span> Quick Tests
        </div>
        <div class="nav-item" data-page="endpoints">
            <span>ğŸ”Œ</span> Endpoints
        </div>
        <div class="nav-item" data-page="test">
            <span>ğŸ§ª</span> Test API
        </div>
        <div class="nav-item" data-page="activity">
            <span>ğŸ“</span> Activity
        </div>
        <div class="nav-item" data-page="settings">
            <span>âš™ï¸</span> Settings
        </div>
    </div>

    <div class="main-content">
        <div class="header">
            <h1 id="page-title">Dashboard</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="current-server" style="color: #888; font-size: 12px; font-family: monospace;"></span>
                <span id="server-status" class="status-badge status-pending">Checking...</span>
                <button class="btn btn-secondary" onclick="switchServer()" style="font-size: 12px; padding: 6px 12px;">ğŸ”„ Switch Server</button>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page">
                <div class="hero-section">
                    <div class="hero-content">
                        <h1>ğŸ’¬ Real-time Chat Application API</h1>
                        <p>Há»‡ thá»‘ng API backend máº¡nh máº½ cho á»©ng dá»¥ng chat real-time vá»›i MongoDB vÃ  WebSocket. Cung cáº¥p Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng tá»« authentication Ä‘áº¿n real-time messaging vá»›i hiá»‡u suáº¥t cao vÃ  báº£o máº­t tá»‘t.</p>
                        <div class="hero-actions">
                            <button class="btn btn-primary" onclick="testEndpoint('GET', '/api/health')">ğŸ” Test Health</button>
                            <button class="btn btn-primary" onclick="testEndpoint('GET', '/api')">ğŸ“‹ API Info</button>
                            <button class="btn btn-secondary" onclick="loadEndpoints()">ğŸ”„ Refresh</button>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card total">
                        <div class="stat-card-header">
                        <h3>Total Endpoints</h3>
                            <span class="stat-icon">ğŸ“Š</span>
                        </div>
                        <div class="value" id="stat-total">0</div>
                        <div class="stat-card-footer">Available API endpoints</div>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-card-header">
                        <h3>Active Requests</h3>
                            <span class="stat-icon">âš¡</span>
                        </div>
                        <div class="value" id="stat-active">0</div>
                        <div class="stat-card-footer">Currently processing</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-card-header">
                        <h3>Success Rate</h3>
                            <span class="stat-icon">âœ…</span>
                        </div>
                        <div class="value" id="stat-success">0%</div>
                        <div class="stat-card-footer">Successful requests</div>
                    </div>
                    <div class="stat-card error">
                        <div class="stat-card-header">
                        <h3>Errors</h3>
                            <span class="stat-icon">âŒ</span>
                        </div>
                        <div class="value" id="stat-errors">0</div>
                        <div class="stat-card-footer">Failed requests</div>
                    </div>
                </div>

                <div class="features-grid">
                    <div class="feature-card">
                        <div class="icon">ğŸ”</div>
                        <h3>Authentication System</h3>
                        <p>ÄÄƒng kÃ½, Ä‘Äƒng nháº­p, JWT tokens, email verification, password reset hoÃ n chá»‰nh</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">âš¡</div>
                        <h3>Real-time Messaging</h3>
                        <p>Gá»­i/nháº­n tin nháº¯n real-time qua WebSocket vá»›i typing indicators vÃ  presence</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ‘¥</div>
                        <h3>Groups & Friends</h3>
                        <p>Quáº£n lÃ½ nhÃ³m chat, báº¡n bÃ¨, gá»­i/nháº­n friend requests, block/unblock users</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ“</div>
                        <h3>File Upload</h3>
                        <p>Upload áº£nh, video, voice, sticker, avatar vá»›i Multer vÃ  validation</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ”</div>
                        <h3>Advanced Search</h3>
                        <p>Full-text search messages, search users, advanced filters vÃ  pagination</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ””</div>
                        <h3>Notifications</h3>
                        <p>Há»‡ thá»‘ng thÃ´ng bÃ¡o real-time cho friend requests, mentions, reactions</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ’¬</div>
                        <h3>Message Features</h3>
                        <p>Reactions, replies, mentions, read receipts, message updates vÃ  deletion</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ğŸ›¡ï¸</div>
                        <h3>Security</h3>
                        <p>Input validation, rate limiting, IDOR protection, password hashing, CORS</p>
                    </div>
                </div>

                <div class="section">
                    <h2>ğŸ–¥ï¸ Server Information</h2>
                    <div id="server-info" style="color: #aaa; line-height: 1.8;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="color: #4a9eff;">â—</span>
                            <span>Loading server information...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Page -->
            <div id="page-about" class="page hidden">
                <!-- Hero Section -->
                <div class="about-hero">
                    <div class="about-hero-content">
                        <h1>ğŸ’¬ Real-time Chat Application API</h1>
                        <p>
                            Há»‡ thá»‘ng backend máº¡nh máº½ vÃ  hoÃ n chá»‰nh cho á»©ng dá»¥ng chat real-time. 
                            Cung cáº¥p Ä‘áº§y Ä‘á»§ cÃ¡c tÃ­nh nÄƒng tá»« authentication, real-time messaging, 
                            Ä‘áº¿n quáº£n lÃ½ groups, friends vÃ  notifications vá»›i hiá»‡u suáº¥t cao vÃ  báº£o máº­t tá»‘t.
                        </p>
                    </div>
                </div>

                <!-- Features Section -->
                <div class="feature-section">
                    <h2>ğŸ” Authentication & Security</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>ğŸ”‘ ÄÄƒng kÃ½/ÄÄƒng nháº­p</strong>
                            <span>Há»‡ thá»‘ng xÃ¡c thá»±c hoÃ n chá»‰nh vá»›i JWT tokens, há»— trá»£ refresh token tá»± Ä‘á»™ng</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ“§ Email Verification</strong>
                            <span>XÃ¡c thá»±c email khi Ä‘Äƒng kÃ½ tÃ i khoáº£n vá»›i mÃ£ OTP 6 sá»‘</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ”’ Password Reset</strong>
                            <span>QuÃªn máº­t kháº©u vÃ  reset qua email vá»›i token báº£o máº­t</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ›¡ï¸ Security Features</strong>
                            <span>Rate limiting, input validation, IDOR protection, password hashing vá»›i bcrypt</span>
                        </div>
                    </div>
                </div>

                <div class="feature-section">
                    <h2>ğŸ’¬ Real-time Messaging</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>âš¡ WebSocket Support</strong>
                            <span>Káº¿t ná»‘i real-time qua WebSocket cho instant messaging, khÃ´ng delay</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ“ Message Types</strong>
                            <span>Há»— trá»£ text, file, image, video, voice, sticker vá»›i validation Ä‘áº§y Ä‘á»§</span>
                        </div>
                        <div class="feature-item">
                            <strong>âœ¨ Message Features</strong>
                            <span>Edit, delete, reactions (emoji), replies, mentions (@username)</span>
                        </div>
                        <div class="feature-item">
                            <strong>âœ“ Read Receipts</strong>
                            <span>Theo dÃµi tin nháº¯n Ä‘Ã£ Ä‘á»c/chÆ°a Ä‘á»c, Ä‘áº¿m sá»‘ unread messages</span>
                        </div>
                        <div class="feature-item">
                            <strong>âŒ¨ï¸ Typing Indicators</strong>
                            <span>Hiá»ƒn thá»‹ real-time khi user Ä‘ang gÃµ tin nháº¯n</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸŸ¢ User Presence</strong>
                            <span>Online/offline status tracking, hiá»ƒn thá»‹ tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng</span>
                        </div>
                    </div>
                </div>

                <div class="feature-section">
                    <h2>ğŸ‘¥ Social Features</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>ğŸ‘« Friends System</strong>
                            <span>Gá»­i/nháº­n friend requests, quáº£n lÃ½ danh sÃ¡ch báº¡n bÃ¨, xem status báº¡n bÃ¨</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Groups Management</strong>
                            <span>Táº¡o vÃ  quáº£n lÃ½ nhÃ³m chat, thÃªm/xÃ³a members, phÃ¢n quyá»n admin/owner</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸš« Block/Unblock</strong>
                            <span>Cháº·n vÃ  bá» cháº·n users, kiá»ƒm tra tráº¡ng thÃ¡i block</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ” User Search</strong>
                            <span>TÃ¬m kiáº¿m users theo username vá»›i pagination vÃ  filters</span>
                        </div>
                    </div>
                </div>

                <div class="feature-section">
                    <h2>ğŸ“ File Management</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>ğŸ“¤ File Upload</strong>
                            <span>Upload áº£nh, video, voice, sticker, avatar vá»›i Multer middleware</span>
                        </div>
                        <div class="feature-item">
                            <strong>âœ… File Validation</strong>
                            <span>Kiá»ƒm tra file type, size, format trÆ°á»›c khi upload</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ’¾ Storage System</strong>
                            <span>LÆ°u trá»¯ file cÃ³ tá»• chá»©c trong thÆ° má»¥c Uploads/ vá»›i phÃ¢n loáº¡i rÃµ rÃ ng</span>
                        </div>
                    </div>
                </div>

                <div class="feature-section">
                    <h2>ğŸ” Search & Discovery</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>ğŸ” Full-text Search</strong>
                            <span>TÃ¬m kiáº¿m messages vá»›i MongoDB text search, tá»‘i Æ°u performance</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ¯ Advanced Filters</strong>
                            <span>Lá»c theo type, date range, source, room vá»›i nhiá»u Ä‘iá»u kiá»‡n</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ“„ Pagination</strong>
                            <span>Há»— trá»£ limit, skip cho káº¿t quáº£ lá»›n, tá»‘i Æ°u tá»‘c Ä‘á»™ load</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ“Š Search Analytics</strong>
                            <span>Hiá»ƒn thá»‹ total results, hasMore, relevance score</span>
                        </div>
                    </div>
                </div>

                <div class="feature-section">
                    <h2>ğŸ”” Notifications</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <strong>âš¡ Real-time Notifications</strong>
                            <span>ThÃ´ng bÃ¡o instant cho friend requests, mentions, reactions</span>
                        </div>
                        <div class="feature-item">
                            <strong>ğŸ“‹ Notification Types</strong>
                            <span>Friend request, message mention, reaction, group invite</span>
                        </div>
                        <div class="feature-item">
                            <strong>âœ“ Read Status</strong>
                            <span>ÄÃ¡nh dáº¥u Ä‘Ã£ Ä‘á»c/chÆ°a Ä‘á»c, mark all as read</span>
                        </div>
                    </div>
                </div>

                <!-- Tech Stack Section -->
                <div class="feature-section">
                    <h2>ğŸ› ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng</h2>
                    <p style="color: #aaa; margin-bottom: 20px; line-height: 1.8;">
                        API Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i cÃ¡c cÃ´ng nghá»‡ hiá»‡n Ä‘áº¡i vÃ  phá»• biáº¿n, Ä‘áº£m báº£o hiá»‡u suáº¥t cao, 
                        báº£o máº­t tá»‘t vÃ  dá»… dÃ ng má»Ÿ rá»™ng.
                    </p>
                    <div class="tech-stack">
                        <span class="tech-badge">Node.js</span>
                        <span class="tech-badge">Express.js</span>
                        <span class="tech-badge">MongoDB</span>
                        <span class="tech-badge">WebSocket (ws)</span>
                        <span class="tech-badge">JWT</span>
                        <span class="tech-badge">Multer</span>
                        <span class="tech-badge">Nodemailer</span>
                        <span class="tech-badge">bcryptjs</span>
                        <span class="tech-badge">CORS</span>
                        <span class="tech-badge">Rate Limiting</span>
                        <span class="tech-badge">UUID</span>
                    </div>
                </div>

                <!-- Usage Section -->
                <div class="feature-section">
                    <h2>ğŸš€ CÃ¡ch sá»­ dá»¥ng</h2>
                    <p style="color: #aaa; margin-bottom: 25px; line-height: 1.8;">
                        Dashboard nÃ y cung cáº¥p Ä‘áº§y Ä‘á»§ cÃ´ng cá»¥ Ä‘á»ƒ test vÃ  quáº£n lÃ½ API má»™t cÃ¡ch dá»… dÃ ng.
                    </p>
                    <div class="usage-steps">
                        <div class="usage-step">
                            <div class="usage-step-number">1</div>
                            <h3>Test API</h3>
                            <p>Sá»­ dá»¥ng tab "Test API" Ä‘á»ƒ gá»­i requests thá»§ cÃ´ng hoáº·c "Quick Tests" Ä‘á»ƒ cháº¡y preset cÃ³ sáºµn</p>
                        </div>
                        <div class="usage-step">
                            <div class="usage-step-number">2</div>
                            <h3>Xem Endpoints</h3>
                            <p>Tab "Endpoints" hiá»ƒn thá»‹ táº¥t cáº£ API endpoints cÃ³ sáºµn vá»›i method vÃ  path</p>
                        </div>
                        <div class="usage-step">
                            <div class="usage-step-number">3</div>
                            <h3>Quáº£n lÃ½ Tokens</h3>
                            <p>VÃ o "Settings" Ä‘á»ƒ cáº¥u hÃ¬nh base URL, access token, refresh token vÃ  variables</p>
                        </div>
                        <div class="usage-step">
                            <div class="usage-step-number">4</div>
                            <h3>Theo dÃµi Activity</h3>
                            <p>Tab "Activity" hiá»ƒn thá»‹ lá»‹ch sá»­ cÃ¡c requests Ä‘Ã£ gá»­i vá»›i status vÃ  response time</p>
                        </div>
                        <div class="usage-step">
                            <div class="usage-step-number">5</div>
                            <h3>Quick Tests</h3>
                            <p>Sá»­ dá»¥ng preset cÃ³ sáºµn Ä‘á»ƒ test nhanh: register, login, send message, create group</p>
                        </div>
                    </div>
                </div>

                <!-- Documentation Section -->
                <div class="doc-section">
                    <h2>ğŸ“š API Documentation</h2>
                    <p style="color: #aaa; margin-bottom: 20px; line-height: 1.8;">
                        Xem chi tiáº¿t API documentation táº¡i tab "Endpoints" hoáº·c truy cáº­p endpoint sau Ä‘á»ƒ xem danh sÃ¡ch Ä‘áº§y Ä‘á»§:
                    </p>
                    <div class="code-block">
                        <code>GET /api</code>
                    </div>
                    <p style="color: #aaa; margin-top: 20px; margin-bottom: 15px; line-height: 1.8;">
                        <strong style="color: #4a9eff;">Authentication:</strong> Táº¥t cáº£ cÃ¡c endpoints yÃªu cáº§u authentication 
                        (trá»« auth endpoints) cáº§n header:
                    </p>
                    <div class="code-block">
                        <code>Authorization: Bearer {accessToken}</code>
                    </div>
                    <p style="color: #aaa; margin-top: 20px; line-height: 1.8;">
                        Access token cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c sau khi Ä‘Äƒng nháº­p hoáº·c Ä‘Äƒng kÃ½ thÃ nh cÃ´ng. 
                        Sá»­ dá»¥ng refresh token Ä‘á»ƒ láº¥y access token má»›i khi token háº¿t háº¡n.
                    </p>
                </div>
            </div>

            <!-- Endpoints Page -->
            <div id="page-endpoints" class="page hidden">
                <div class="section">
                    <h2>Available Endpoints</h2>
                    <div class="endpoint-list" id="endpoints-list">
                        <div style="color: #888; text-align: center; padding: 20px;">Loading endpoints...</div>
                    </div>
                </div>
            </div>

            <!-- Quick Tests Page -->
            <div id="page-quicktests" class="page hidden">
                <div class="section">
                    <h2>1-Click Presets</h2>
                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom: 12px;">
                        <button class="btn btn-primary" onclick="runSmokeTest()">Run Smoke Test</button>
                        <button class="btn btn-secondary" onclick="renderQuickTests()">Reload Presets</button>
                    </div>
                    <div style="color:#888; font-size: 13px; margin-bottom: 12px;">
                        Tip: preset nÃ o cáº§n token thÃ¬ app sáº½ auto gáº¯n <code>Authorization: Bearer</code> tá»« Settings. CÃ¡c ID/token sáº½ auto lÆ°u vÃ o Variables sau má»—i request.
                    </div>
                    <div class="endpoint-list" id="quicktests-list">
                        <div style="color: #888; text-align: center; padding: 20px;">Loading presets...</div>
                    </div>
                </div>

                <div class="test-panel">
                    <h2>Quick Test Response</h2>
                    <div class="response-area" id="quicktest-response" style="display: none;">
                        <pre id="quicktest-response-content"></pre>
                    </div>
                </div>
            </div>

            <!-- Test API Page -->
            <div id="page-test" class="page hidden">
                <div class="test-panel">
                    <h2>Test API Endpoint</h2>
                    <div class="section" style="margin-top: 0; margin-bottom: 15px;">
                        <h2 style="margin-bottom: 10px;">Load Preset (khá»i gÃµ JSON)</h2>
                        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                            <select id="preset-select" style="min-width: 320px;"></select>
                            <button class="btn btn-secondary" type="button" onclick="loadSelectedPreset()">Load</button>
                            <button class="btn btn-primary" type="button" onclick="runSelectedPreset()">Run</button>
                        </div>
                        <div style="color:#888; font-size: 12px; margin-top: 8px;">
                            Variables: <code>${"{ACCESS_TOKEN}"}</code>, <code>${"{REFRESH_TOKEN}"}</code>, <code>${"{USER_ID}"}</code>, <code>${"{GROUP_ID}"}</code>, <code>${"{MESSAGE_ID}"}</code>, <code>${"{ROOM_ID}"}</code>...
                        </div>
                    </div>
                    <form class="test-form" onsubmit="handleTestSubmit(event)">
                        <div class="form-group">
                            <label>Method</label>
                            <select id="test-method">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>URL</label>
                            <input type="text" id="test-url" placeholder="http://103.149.252.114:3000/api/auth/login" value="http://103.149.252.114:3000">
                        </div>
                        <div class="form-group">
                            <label>Headers (JSON)</label>
                            <textarea id="test-headers" placeholder='{"Content-Type": "application/json"}'></textarea>
                        </div>
                        <div class="form-group">
                            <label>Body (JSON)</label>
                            <textarea id="test-body" placeholder='{"username": "test", "password": "test"}'></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Request</button>
                    </form>
                    <div class="response-area" id="test-response" style="display: none;">
                        <h3 style="margin-bottom: 10px;">Response</h3>
                        <pre id="test-response-content"></pre>
                    </div>
                </div>
            </div>

            <!-- Activity Page -->
            <div id="page-activity" class="page hidden">
                <div class="section">
                    <h2>Recent Activity</h2>
                    <div id="activity-list">
                        <div style="color: #888; text-align: center; padding: 20px;">No activity yet</div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="page-settings" class="page hidden">
                <div class="section">
                    <h2>API Configuration</h2>
                    <div class="form-group">
                        <label>Base URL</label>
                        <input type="text" id="base-url" value="http://103.149.252.114:3000" onchange="saveSettings()">
                    </div>
                    <div class="form-group">
                        <label>Access Token (Optional)</label>
                        <input type="password" id="access-token" placeholder="Bearer token" onchange="saveSettings()">
                    </div>
                    <div class="form-group">
                        <label>Refresh Token (Optional)</label>
                        <input type="password" id="refresh-token" placeholder="refreshToken" onchange="saveSettings()">
                    </div>
                    <div class="form-group">
                        <label>Variables (IDs)</label>
                        <textarea id="vars-json" placeholder='{\"USER_ID\":\"...\",\"GROUP_ID\":\"...\",\"MESSAGE_ID\":\"...\",\"ROOM_ID\":\"room123\"}'></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Auto-detect base URL from current location, fallback to server IP
        const getDefaultBaseUrl = () => {
            // If running on the server itself, use current origin
            if (window.location.hostname === '103.149.252.114' || window.location.hostname.includes('103.149.252.114')) {
                return window.location.origin;
            }
            // Otherwise use the server IP
            return 'http://103.149.252.114:3000';
        };
        const API_BASE = localStorage.getItem('apiBaseUrl') || getDefaultBaseUrl();
        let accessToken = localStorage.getItem('accessToken') || '';
        let refreshToken = localStorage.getItem('refreshToken') || '';
        let vars = JSON.parse(localStorage.getItem('apiVars') || '{}');
        let activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');
        let stats = {
            total: 0,
            active: 0,
            success: 0,
            errors: 0
        };

        // ---- Presets ----
        // Default: cÃ³ 1 sá»‘ preset cÆ¡ báº£n. Sau Ä‘Ã³ sáº½ auto-sync theo GET /api (endpoints).
        let PRESETS = [
          { key: 'health', name: 'Health Check', method: 'GET', path: '/api/health', requiresAuth: false },
          { key: 'apiInfo', name: 'API Info', method: 'GET', path: '/api', requiresAuth: false },

          // Auth
          {
            key: 'auth.register',
            name: 'Auth - Register',
            method: 'POST',
            path: '/api/auth/register',
            requiresAuth: false,
            body: { username: 'tu_${TS8}', password: 'password123', email: 'test_${TS8}@example.com' },
            onSuccess: (json) => {
              const at = json?.data?.accessToken;
              const rt = json?.data?.refreshToken;
              const uid = json?.data?.user?._id || json?.data?.user?.id;
              if (at) setAccessToken(at);
              if (rt) setRefreshToken(rt);
              if (uid) setVar('USER_ID', uid);
            }
          },
          {
            key: 'auth.login',
            name: 'Auth - Login',
            method: 'POST',
            path: '/api/auth/login',
            requiresAuth: false,
            body: { username: '${LAST_USERNAME}', password: 'password123' },
            onSuccess: (json) => {
              const at = json?.data?.accessToken;
              const rt = json?.data?.refreshToken;
              const uid = json?.data?.user?._id || json?.data?.user?.id;
              if (at) setAccessToken(at);
              if (rt) setRefreshToken(rt);
              if (uid) setVar('USER_ID', uid);
            }
          },
          {
            key: 'auth.refresh',
            name: 'Auth - Refresh Token',
            method: 'POST',
            path: '/api/auth/refresh',
            requiresAuth: false,
            body: { refreshToken: '${REFRESH_TOKEN}' },
            onSuccess: (json) => {
              const at = json?.data?.accessToken;
              const rt = json?.data?.refreshToken;
              if (at) setAccessToken(at);
              if (rt) setRefreshToken(rt);
            }
          },
          {
            key: 'auth.logout',
            name: 'Auth - Logout',
            method: 'POST',
            path: '/api/auth/logout',
            requiresAuth: true,
            body: { refreshToken: '${REFRESH_TOKEN}' }
          },

          // Users
          { key: 'users.me', name: 'Users - Get Me', method: 'GET', path: '/api/users/me', requiresAuth: true },
          { key: 'users.search', name: 'Users - Search (query=test)', method: 'GET', path: '/api/users/search/test?limit=20', requiresAuth: true },
          { key: 'users.updateProfile', name: 'Users - Update Profile', method: 'PUT', path: '/api/users/me', requiresAuth: true, body: { username: 'newname_${TS}', email: 'new_${TS}@example.com' } },
          { key: 'users.statusUpdate', name: 'Users - Update Status', method: 'PUT', path: '/api/users/status', requiresAuth: true, body: { status: 'online' } },
          { key: 'users.getStatus', name: 'Users - Get User Status', method: 'GET', path: '/api/users/${USER_ID}/status', requiresAuth: true },
          { key: 'users.friendsStatus', name: 'Users - Get Friends Status', method: 'GET', path: '/api/users/friends/status', requiresAuth: true },

          // Block
          { key: 'users.block', name: 'Users - Block User', method: 'POST', path: '/api/users/block', requiresAuth: true, body: { userId: '${USER_ID_TARGET}' } },
          { key: 'users.unblock', name: 'Users - Unblock User', method: 'POST', path: '/api/users/unblock', requiresAuth: true, body: { userId: '${USER_ID_TARGET}' } },
          { key: 'users.blocked', name: 'Users - List Blocked', method: 'GET', path: '/api/users/blocked?limit=50&skip=0', requiresAuth: true },
          { key: 'users.blockCheck', name: 'Users - Check Block Status', method: 'GET', path: '/api/users/check/${USER_ID_TARGET}', requiresAuth: true },

          // Groups
          {
            key: 'groups.create',
            name: 'Groups - Create',
            method: 'POST',
            path: '/api/groups',
            requiresAuth: true,
            body: { name: 'My Group ${TS}', description: 'Group description', isPrivate: false },
            onSuccess: (json) => {
              const gid = json?._id || json?.data?._id || json?.data?.group?._id;
              if (gid) setVar('GROUP_ID', gid);
            }
          },
          { key: 'groups.list', name: 'Groups - List (my)', method: 'GET', path: '/api/groups?type=my&limit=50&skip=0', requiresAuth: true },
          { key: 'groups.get', name: 'Groups - Get', method: 'GET', path: '/api/groups/${GROUP_ID}', requiresAuth: true },
          { key: 'groups.update', name: 'Groups - Update', method: 'PUT', path: '/api/groups/${GROUP_ID}', requiresAuth: true, body: { name: 'Updated Group ${TS}', description: 'Updated', isPrivate: true } },
          { key: 'groups.members', name: 'Groups - Get Members', method: 'GET', path: '/api/groups/${GROUP_ID}/members', requiresAuth: true },
          { key: 'groups.addMember', name: 'Groups - Add Member', method: 'POST', path: '/api/groups/${GROUP_ID}/members', requiresAuth: true, body: { userId: '${USER_ID_TARGET}' } },
          { key: 'groups.removeMember', name: 'Groups - Remove Member', method: 'DELETE', path: '/api/groups/${GROUP_ID}/members/${USER_ID_TARGET}', requiresAuth: true },
          { key: 'groups.promote', name: 'Groups - Promote Member', method: 'POST', path: '/api/groups/${GROUP_ID}/members/${USER_ID_TARGET}/promote', requiresAuth: true },
          { key: 'groups.demote', name: 'Groups - Demote Admin', method: 'POST', path: '/api/groups/${GROUP_ID}/members/${USER_ID_TARGET}/demote', requiresAuth: true },
          { key: 'groups.leave', name: 'Groups - Leave Group', method: 'POST', path: '/api/groups/${GROUP_ID}/leave', requiresAuth: true },
          { key: 'groups.statistics', name: 'Groups - Get Statistics', method: 'GET', path: '/api/groups/${GROUP_ID}/statistics', requiresAuth: true },
          { key: 'groups.transferOwnership', name: 'Groups - Transfer Ownership', method: 'POST', path: '/api/groups/${GROUP_ID}/transfer-ownership', requiresAuth: true, body: { newOwnerId: '${USER_ID_TARGET}' } },
          { key: 'groups.delete', name: 'Groups - Delete', method: 'DELETE', path: '/api/groups/${GROUP_ID}', requiresAuth: true },
          {
            key: 'message.send',
            name: 'Message - Send Text',
            method: 'POST',
            path: '/api/message/send',
            requiresAuth: true,
            body: { roomId: '${ROOM_ID}', text: 'Hello world ${TS}' },
            onSuccess: (json) => {
              const mid = json?.data?._id || json?._id;
              if (mid) setVar('MESSAGE_ID', mid);
            }
          },
          { key: 'message.get', name: 'Message - Get Messages', method: 'GET', path: '/api/message/${ROOM_ID}?limit=50&skip=0', requiresAuth: true },
          { key: 'message.reply', name: 'Message - Send Reply', method: 'POST', path: '/api/message/send', requiresAuth: true, body: { roomId: '${ROOM_ID}', text: 'reply ${TS}', replyToMessageId: '${MESSAGE_ID}' } },
          { key: 'message.update', name: 'Message - Update', method: 'PUT', path: '/api/message/${MESSAGE_ID}', requiresAuth: true, body: { text: 'Updated ${TS}' } },
          { key: 'message.replies', name: 'Message - Get Replies', method: 'GET', path: '/api/message/${MESSAGE_ID}/replies?limit=50&skip=0', requiresAuth: true },
          { key: 'message.mentionsMe', name: 'Message - Mentions Me', method: 'GET', path: '/api/message/mentions/me?limit=50&skip=0', requiresAuth: true },
          { key: 'message.reactionAdd', name: 'Message - Add Reaction', method: 'POST', path: '/api/message/${MESSAGE_ID}/reaction', requiresAuth: true, body: { emoji: 'ğŸ‘' } },
          { key: 'message.reactions', name: 'Message - Get Reactions', method: 'GET', path: '/api/message/${MESSAGE_ID}/reactions', requiresAuth: true },
          { key: 'message.read', name: 'Message - Mark Read', method: 'POST', path: '/api/message/${MESSAGE_ID}/read', requiresAuth: true },
          { key: 'message.readAll', name: 'Message - Mark All Read', method: 'POST', path: '/api/message/room/${ROOM_ID}/read-all', requiresAuth: true },
          { key: 'message.pin', name: 'Message - Pin', method: 'POST', path: '/api/message/${MESSAGE_ID}/pin', requiresAuth: true },
          { key: 'message.unpin', name: 'Message - Unpin', method: 'DELETE', path: '/api/message/${MESSAGE_ID}/pin', requiresAuth: true },
          { key: 'message.pinned', name: 'Message - Get Pinned', method: 'GET', path: '/api/message/room/${ROOM_ID}/pinned', requiresAuth: true },
          { key: 'message.delete', name: 'Message - Delete', method: 'DELETE', path: '/api/message/${MESSAGE_ID}', requiresAuth: true },

          // Notifications
          { key: 'noti.get', name: 'Notifications - Get', method: 'GET', path: '/api/notifications?limit=50&skip=0&unreadOnly=false', requiresAuth: true },
          { key: 'noti.markRead', name: 'Notifications - Mark Read', method: 'PUT', path: '/api/notifications/${NOTIFICATION_ID}/read', requiresAuth: true },
          { key: 'noti.markAllRead', name: 'Notifications - Mark All Read', method: 'PUT', path: '/api/notifications/read-all', requiresAuth: true },

          // Friends (needs USER_ID_TARGET / REQUEST_ID / FRIEND_ID)
          { key: 'friends.request', name: 'Friends - Send Request', method: 'POST', path: '/api/friends/request', requiresAuth: true, body: { userId: '${USER_ID_TARGET}' } },
          { key: 'friends.accept', name: 'Friends - Accept', method: 'POST', path: '/api/friends/accept', requiresAuth: true, body: { requestId: '${REQUEST_ID}' } },
          { key: 'friends.reject', name: 'Friends - Reject', method: 'POST', path: '/api/friends/reject', requiresAuth: true, body: { requestId: '${REQUEST_ID}' } },
          { key: 'friends.requests', name: 'Friends - List Requests', method: 'GET', path: '/api/friends/requests?type=received&limit=50&skip=0', requiresAuth: true },
          { key: 'friends.list', name: 'Friends - List', method: 'GET', path: '/api/friends?limit=50&skip=0', requiresAuth: true },
          { key: 'friends.remove', name: 'Friends - Remove', method: 'DELETE', path: '/api/friends/${FRIEND_ID}', requiresAuth: true }
        ];

        const BODY_TEMPLATES = {
          'POST /api/auth/register': { username: 'tu_${TS8}', password: 'password123', email: 'test_${TS8}@example.com' },
          'POST /api/auth/login': { username: '${LAST_USERNAME}', password: 'password123' },
          'POST /api/auth/refresh': { refreshToken: '${REFRESH_TOKEN}' },
          'POST /api/auth/logout': { refreshToken: '${REFRESH_TOKEN}' },
          'POST /api/auth/verify-email': { code: '123456' },
          'POST /api/auth/resend-verification': { email: 'test_${TS8}@example.com' },
          'POST /api/auth/forgot-password': { email: 'test_${TS8}@example.com' },
          'POST /api/auth/reset-password': { token: '${RESET_TOKEN}', newPassword: 'newpassword123' },

          'PUT /api/users/me': { username: 'new_${TS8}', email: 'new_${TS8}@example.com' },
          'PUT /api/users/status': { status: 'online' },
          'POST /api/users/block': { userId: '${USER_ID_TARGET}' },
          'POST /api/users/unblock': { userId: '${USER_ID_TARGET}' },

          'POST /api/message/send': { roomId: '${ROOM_ID}', text: 'Hello ${TS8}' },
          'PUT /api/message/:messageId': { text: 'Updated ${TS8}' },
          'POST /api/message/:messageId/reaction': { emoji: 'ğŸ‘' },
          'POST /api/message/voice/upload': {},
          'POST /api/message/voice/send': { roomId: '${ROOM_ID}', fileUrl: '/Uploads/Voice/voice-123.mp3', duration: 30 },

          'POST /api/groups': { name: 'My Group ${TS8}', description: 'Group description', isPrivate: false },
          'PUT /api/groups/:groupId': { name: 'Updated Group ${TS8}', description: 'Updated description', isPrivate: true },
          'POST /api/groups/:groupId/members': { userId: '${USER_ID_TARGET}' },
          'POST /api/groups/:groupId/leave': {},
          'POST /api/groups/:groupId/transfer-ownership': { newOwnerId: '${USER_ID_TARGET}' },
          'POST /api/groups/:groupId/invite-code': { expiresIn: 24 },
          'POST /api/groups/join-by-code': { code: 'INVITE_CODE_HERE' },
          'POST /api/groups/:groupId/mute': { duration: 24 },
          'POST /api/groups/:groupId/unmute': {},
          'GET /api/groups/:groupId/mute-status': {},
          'GET /api/groups/muted': {},

          'POST /api/calls/initiate': { recipientId: '${USER_ID_TARGET}', callType: 'voice', roomId: '${ROOM_ID}' },
          'POST /api/calls/:callId/accept': {},
          'POST /api/calls/:callId/reject': { reason: 'Busy' },
          'POST /api/calls/:callId/end': { duration: 120 },
          'GET /api/calls/:callId': {},
          'GET /api/calls/history': { limit: 50, offset: 0 },

          'POST /api/friends/request': { userId: '${USER_ID_TARGET}' },
          'POST /api/friends/accept': { requestId: '${REQUEST_ID}' },
          'POST /api/friends/reject': { requestId: '${REQUEST_ID}' }
        };

        const ON_SUCCESS_BY_SIG = {
          'POST /api/auth/register': (json) => {
            const at = json?.data?.accessToken;
            const rt = json?.data?.refreshToken;
            const uid = json?.data?.user?._id || json?.data?.user?.id;
            if (at) setAccessToken(at);
            if (rt) setRefreshToken(rt);
            if (uid) setVar('USER_ID', uid);
          },
          'POST /api/auth/login': (json) => {
            const at = json?.data?.accessToken;
            const rt = json?.data?.refreshToken;
            const uid = json?.data?.user?._id || json?.data?.user?.id;
            if (at) setAccessToken(at);
            if (rt) setRefreshToken(rt);
            if (uid) setVar('USER_ID', uid);
          },
          'POST /api/auth/refresh': (json) => {
            const at = json?.data?.accessToken;
            const rt = json?.data?.refreshToken;
            if (at) setAccessToken(at);
            if (rt) setRefreshToken(rt);
          },
          'POST /api/groups': (json) => {
            const gid = json?._id || json?.data?._id || json?.data?.group?._id;
            if (gid) setVar('GROUP_ID', gid);
          },
          'POST /api/calls/initiate': (json) => {
            const cid = json?.data?.callId || json?.callId;
            if (cid) setVar('CALL_ID', cid);
          },
          'POST /api/groups/:groupId/invite-code': (json) => {
            const code = json?.data?.code || json?.code;
            if (code) setVar('INVITE_CODE', code);
          },
          'POST /api/message/send': (json) => {
            const mid = json?.data?._id || json?._id;
            if (mid) setVar('MESSAGE_ID', mid);
          }
        };

        // Defaults for vars
        if (!vars.ROOM_ID) vars.ROOM_ID = 'room123';
        if (!vars.USER_ID_TARGET) vars.USER_ID_TARGET = '';
        if (!vars.NOTIFICATION_ID) vars.NOTIFICATION_ID = '';
        if (!vars.REQUEST_ID) vars.REQUEST_ID = '';
        if (!vars.FRIEND_ID) vars.FRIEND_ID = '';

        function saveVars() {
          localStorage.setItem('apiVars', JSON.stringify(vars));
          const varsTextarea = document.getElementById('vars-json');
          if (varsTextarea) varsTextarea.value = JSON.stringify(vars, null, 2);
        }
        function setVar(key, value) {
          if (!key) return;
          vars[key] = value;
          saveVars();
        }
        function setAccessToken(token) {
          accessToken = token || '';
          localStorage.setItem('accessToken', accessToken);
          const input = document.getElementById('access-token');
          if (input) input.value = accessToken;
        }
        function setRefreshToken(token) {
          refreshToken = token || '';
          localStorage.setItem('refreshToken', refreshToken);
          const input = document.getElementById('refresh-token');
          if (input) input.value = refreshToken;
        }

        function substituteTemplate(value) {
          const ts = Date.now().toString();
          const ts8 = ts.slice(-8);
          const lastUsername = localStorage.getItem('lastUsername') || `testuser_${ts}`;
          if (typeof value === 'string') {
            return value
              .replaceAll('${TS}', ts)
              .replaceAll('${TS8}', ts8)
              .replaceAll('${ACCESS_TOKEN}', accessToken || '')
              .replaceAll('${REFRESH_TOKEN}', refreshToken || '')
              .replaceAll('${LAST_USERNAME}', lastUsername)
              .replaceAll('${ROOM_ID}', vars.ROOM_ID || 'room123')
              .replaceAll('${USER_ID}', vars.USER_ID || '')
              .replaceAll('${GROUP_ID}', vars.GROUP_ID || '')
              .replaceAll('${MESSAGE_ID}', vars.MESSAGE_ID || '')
              .replaceAll('${USER_ID_TARGET}', vars.USER_ID_TARGET || '')
              .replaceAll('${NOTIFICATION_ID}', vars.NOTIFICATION_ID || '')
              .replaceAll('${REQUEST_ID}', vars.REQUEST_ID || '')
              .replaceAll('${FRIEND_ID}', vars.FRIEND_ID || '');
          }
          if (Array.isArray(value)) return value.map(substituteTemplate);
          if (value && typeof value === 'object') {
            const out = {};
            for (const k of Object.keys(value)) out[k] = substituteTemplate(value[k]);
            return out;
          }
          return value;
        }

        function getPresetByKey(key) {
          return PRESETS.find(p => p.key === key);
        }

        function renderPresetsSelect() {
          const sel = document.getElementById('preset-select');
          if (!sel) return;
          sel.innerHTML = '';
          PRESETS.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.key;
            opt.textContent = `${p.method} ${p.path} â€” ${p.name}`;
            sel.appendChild(opt);
          });
        }

        function loadSelectedPreset() {
          const sel = document.getElementById('preset-select');
          if (!sel) return;
          const preset = getPresetByKey(sel.value);
          if (!preset) return;
          document.getElementById('test-method').value = preset.method;
          document.getElementById('test-url').value = `${API_BASE}${substituteTemplate(preset.path)}`;
          document.getElementById('test-headers').value = '';
          const body = preset.body ? substituteTemplate(preset.body) : '';
          document.getElementById('test-body').value = body ? JSON.stringify(body, null, 2) : '';
        }

        async function runSelectedPreset() {
          const sel = document.getElementById('preset-select');
          if (!sel) return;
          await runPreset(sel.value, { showIn: 'test' });
        }

        function renderQuickTests() {
          const list = document.getElementById('quicktests-list');
          if (!list) return;
          list.innerHTML = '';
          PRESETS.forEach(p => {
            const item = document.createElement('div');
            item.className = 'endpoint-item';
            const methodClass = `method-${p.method.toLowerCase()}`;
            const authBadge = p.requiresAuth
              ? '<span class="status-badge status-pending" style="margin-left:8px;">AUTH</span>'
              : '<span class="status-badge status-success" style="margin-left:8px;">PUBLIC</span>';
            item.innerHTML = `
              <div class="endpoint-info">
                <span class="endpoint-method ${methodClass}">${p.method}</span>
                <span class="endpoint-path">${p.path}</span>
                ${authBadge}
                <div style="color:#aaa; font-size:12px; margin-top:6px;">${p.name}</div>
              </div>
              <div class="endpoint-actions">
                <button class="btn btn-secondary" onclick="loadPresetToTest('${p.key}')">Load</button>
                <button class="btn btn-primary" onclick="runPreset('${p.key}', { showIn: 'quick' })">Run</button>
              </div>
            `;
            list.appendChild(item);
          });
        }

        function loadPresetToTest(key) {
          const preset = getPresetByKey(key);
          if (!preset) return;
          document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
          document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
          document.querySelector('[data-page="test"]').classList.add('active');
          document.getElementById('page-test').classList.remove('hidden');
          document.getElementById('page-title').textContent = 'Test API';
          const sel = document.getElementById('preset-select');
          if (sel) sel.value = key;
          loadSelectedPreset();
        }

        async function runPreset(key, opts = {}) {
          const preset = getPresetByKey(key);
          if (!preset) return;

          const method = preset.method;
          const url = `${API_BASE}${substituteTemplate(preset.path)}`;

          // Build headers
          const headers = { 'Content-Type': 'application/json' };
          if (preset.requiresAuth) {
            // Náº¿u chÆ°a cÃ³ accessToken nhÆ°ng cÃ³ refreshToken, auto refresh trÆ°á»›c
            if (!accessToken && refreshToken && key !== 'auth.refresh') {
              const refreshResult = await runPreset('auth.refresh', { showIn: opts.showIn || 'quick' });
              if (!refreshResult?.ok) {
                alert('Cannot auto-refresh token. Please login or set token in Settings.');
                return;
              }
            }
            if (!accessToken) {
              alert('Missing accessToken. Login/Register first or set token in Settings.');
              return;
            }
            headers['Authorization'] = `Bearer ${accessToken}`;
          }

          const options = { method, headers };
          if (preset.body && (method === 'POST' || method === 'PUT')) {
            options.body = JSON.stringify(substituteTemplate(preset.body));
          }

          // Track lastUsername if this is register
          if (key === 'auth.register') {
            const body = substituteTemplate(preset.body);
            if (body?.username) localStorage.setItem('lastUsername', body.username);
          }

          stats.active++;
          updateStats();
          const startTime = Date.now();

          try {
            const response = await fetch(url, options);
            const endTime = Date.now();
            const responseTime = endTime - startTime;

            const contentType = response.headers.get('content-type');
            let responseData;
            if (contentType && contentType.includes('application/json')) {
              responseData = await response.json();
            } else {
              responseData = await response.text();
            }

            stats.active--;
            if (response.ok) stats.success++; else stats.errors++;
            updateStats();

            addActivity(method, url, response.status, responseTime);

            // Save vars from response if any
            if (response.ok && typeof preset.onSuccess === 'function') {
              try { preset.onSuccess(responseData); } catch (_) {}
            }

            // Auto-pick notificationId/requestId/messageId if list returns items
            if (response.ok) {
              const firstNoti = responseData?.data?.notifications?.[0];
              if (firstNoti?._id) setVar('NOTIFICATION_ID', firstNoti._id);
              const firstReq = responseData?.data?.requests?.[0];
              if (firstReq?._id) setVar('REQUEST_ID', firstReq._id);
              const firstFriend = responseData?.data?.friends?.[0];
              if (firstFriend?.userId) setVar('FRIEND_ID', firstFriend.userId);
            }

            // Show response
            if (opts.showIn === 'quick') {
              const box = document.getElementById('quicktest-response');
              const pre = document.getElementById('quicktest-response-content');
              if (box && pre) {
                box.style.display = 'block';
                box.className = 'response-area' + (response.ok ? '' : ' error');
                pre.textContent = JSON.stringify(responseData, null, 2);
              }
            } else {
              // load into test panel response view
              const responseEl = document.getElementById('test-response');
              const contentEl = document.getElementById('test-response-content');
              if (responseEl && contentEl) {
                responseEl.style.display = 'block';
                responseEl.className = 'response-area' + (response.ok ? '' : ' error');
                contentEl.textContent = JSON.stringify(responseData, null, 2);
              }
            }

            return { ok: response.ok, status: response.status, data: responseData };
          } catch (error) {
            stats.active--;
            stats.errors++;
            updateStats();
            addActivity(method, url, 'ERROR', 0);
            if (opts.showIn === 'quick') {
              const box = document.getElementById('quicktest-response');
              const pre = document.getElementById('quicktest-response-content');
              if (box && pre) {
                box.style.display = 'block';
                box.className = 'response-area error';
                pre.textContent = `Error: ${error.message}`;
              }
            }
            return { ok: false, status: 'ERROR', error: error.message };
          }
        }

        async function runSmokeTest() {
          // Safe-ish flow: health -> api -> register -> me -> refresh -> groups list -> send message -> get messages
          const steps = [
            'health',
            'apiInfo',
            'auth.register',
            'users.me',
            'auth.refresh',
            'groups.list',
            'message.send',
            'message.get'
          ];
          for (const key of steps) {
            // eslint-disable-next-line no-await-in-loop
            const r = await runPreset(key, { showIn: 'quick' });
            if (!r?.ok) break;
          }
        }

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            console.log('ğŸ”µ toggleMobileMenu called');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (!sidebar) {
                console.error('âŒ Sidebar not found!');
                return;
            }
            
            const isOpen = sidebar.classList.contains('open');
            console.log('ğŸ“Š Sidebar state:', isOpen ? 'OPEN' : 'CLOSED');
            console.log('ğŸ“± Window width:', window.innerWidth);
            console.log('ğŸ¯ Sidebar element:', sidebar);
            console.log('ğŸ“ Current left:', sidebar.style.left || 'not set');
            
            // Force all styles inline to override any CSS
            if (!isOpen) {
                console.log('â¡ï¸ Opening sidebar...');
                
                // Add open class first
                sidebar.classList.add('open');
                
                // Clear ALL inline styles first
                sidebar.removeAttribute('style');
                
                // Force reflow
                sidebar.offsetHeight;
                
                // Small delay to ensure CSS is applied
                setTimeout(() => {
                    sidebar.offsetHeight;
                }, 0);
                
                // Set ALL styles fresh with !important - ONLY use LEFT, NO margin-left
                const styles = {
                    'position': 'fixed',
                    'left': '0px',
                    'top': '0px',
                    'right': 'auto',
                    'height': '100vh',
                    'width': '250px',
                    'z-index': '1002',
                    'background': '#1a1a1a',
                    'display': 'flex',
                    'flex-direction': 'column',
                    'transform': 'none',
                    'margin': '0',
                    'margin-left': '0',
                    'margin-right': '0',
                    'padding': '20px 0',
                    'transition': 'left 0.3s ease',
                    'box-shadow': '2px 0 10px rgba(0, 0, 0, 0.5)',
                    'visibility': 'visible',
                    'opacity': '1',
                    'pointer-events': 'auto'
                };
                
                // Apply all styles with !important
                Object.keys(styles).forEach(prop => {
                    sidebar.style.setProperty(prop, styles[prop], 'important');
                });
                
                // Force multiple reflows
                sidebar.offsetHeight;
                sidebar.offsetHeight;
                sidebar.offsetHeight;
                
                // Also set via cssText as backup - ONLY left, NO margin-left
                setTimeout(() => {
                    sidebar.style.setProperty('left', '0px', 'important');
                    sidebar.style.setProperty('margin-left', '0', 'important');
                    sidebar.style.setProperty('margin-right', '0', 'important');
                    sidebar.style.setProperty('right', 'auto', 'important');
                    sidebar.offsetHeight;
                }, 10);
                
                // Verify and fix if needed - ONLY check left, ignore margin-left
                requestAnimationFrame(() => {
                    const cs = window.getComputedStyle(sidebar);
                    const left = cs.left;
                    const leftValue = parseFloat(left);
                    
                    console.log('ğŸ” Final computed left:', left);
                    
                    // Only check left, not margin-left
                    if (leftValue < 0 || left !== '0px') {
                        console.warn('ğŸ”§ Left still wrong, forcing one more time...', left);
                        sidebar.style.setProperty('left', '0px', 'important');
                        sidebar.style.setProperty('margin-left', '0', 'important');
                        sidebar.offsetHeight;
                    } else {
                        console.log('âœ… Left is correct:', left);
                    }
                });
                
                console.log('âœ… Sidebar opened');
                
                // Show overlay on mobile
                if (overlay && window.innerWidth <= 768) {
                    overlay.classList.add('active');
                    console.log('ğŸŒ‘ Overlay activated');
                }
            } else {
                console.log('â¬…ï¸ Closing sidebar...');
                // Close sidebar - use left, not transform
                sidebar.classList.remove('open');
                
                // Clear all inline styles first
                sidebar.removeAttribute('style');
                sidebar.offsetHeight;
                
                // Set closing styles with !important
                sidebar.style.setProperty('position', 'fixed', 'important');
                sidebar.style.setProperty('left', '-250px', 'important');
                sidebar.style.setProperty('top', '0px', 'important');
                sidebar.style.setProperty('height', '100vh', 'important');
                sidebar.style.setProperty('width', '250px', 'important');
                sidebar.style.setProperty('z-index', '1002', 'important');
                sidebar.style.setProperty('margin-left', '0', 'important');
                sidebar.style.setProperty('margin-right', '0', 'important');
                sidebar.style.setProperty('transform', 'none', 'important');
                sidebar.style.setProperty('transition', 'left 0.3s ease', 'important');
                sidebar.style.setProperty('background', '#1a1a1a', 'important');
                sidebar.style.setProperty('display', 'flex', 'important');
                sidebar.style.setProperty('flex-direction', 'column', 'important');
                
                // Force reflow
                sidebar.offsetHeight;
                sidebar.offsetHeight;
                
                // Verify and fix if needed
                requestAnimationFrame(() => {
                    const cs = window.getComputedStyle(sidebar);
                    const left = cs.left;
                    const leftValue = parseFloat(left);
                    
                    console.log('ğŸ” Closing - computed left:', left);
                    
                    // If left is not -250px, force fix
                    if (leftValue > -250 || left !== '-250px') {
                        console.warn('ğŸ”§ Closing - Left still wrong, forcing...', left);
                        sidebar.style.setProperty('left', '-250px', 'important');
                        sidebar.style.setProperty('margin-left', '0', 'important');
                        sidebar.offsetHeight;
                        
                        // Double check
                        requestAnimationFrame(() => {
                            const cs2 = window.getComputedStyle(sidebar);
                            console.log('ğŸ” Closing - Final computed left:', cs2.left);
                            if (parseFloat(cs2.left) > -250) {
                                console.warn('ğŸ”§ Closing - Still wrong, using cssText...');
                                sidebar.style.cssText += '; left: -250px !important; margin-left: 0 !important;';
                                sidebar.offsetHeight;
                            }
                        });
                    } else {
                        console.log('âœ… Closing - Left is correct:', left);
                    }
                });
                
                console.log('âœ… Sidebar closed');
                
                // Hide overlay
                if (overlay) {
                    overlay.classList.remove('active');
                    console.log('ğŸŒ‘ Overlay deactivated');
                }
            }
            
            // Force reflow
            sidebar.offsetHeight;
            
            // Verify final state and fix if needed
            setTimeout(() => {
                const computedStyle = window.getComputedStyle(sidebar);
                console.log('ğŸ” Final computed left:', computedStyle.left);
                console.log('ğŸ” Final computed transform:', computedStyle.transform);
                console.log('ğŸ” Final computed position:', computedStyle.position);
                console.log('ğŸ” Final computed z-index:', computedStyle.zIndex);
                console.log('ğŸ” Inline style left:', sidebar.style.left);
                console.log('ğŸ” Inline style transform:', sidebar.style.transform);
                
                // If transform is still wrong, force fix
                if (!isOpen) {
                    const transform = computedStyle.transform;
                    const isTransformWrong = transform && transform !== 'none' && 
                        transform !== 'matrix(1, 0, 0, 1, 0, 0)' &&
                        !transform.includes('translateX(0');
                    
                    if (isTransformWrong) {
                        console.warn('âš ï¸ Transform still wrong:', transform);
                        console.warn('ğŸ”§ Forcing transform to translateX(0)...');
                        
                        // Remove and reapply
                        sidebar.style.removeProperty('transform');
                        sidebar.offsetHeight; // Force reflow
                        sidebar.style.setProperty('transform', 'translateX(0px)', 'important');
                        sidebar.style.setProperty('left', '0px', 'important');
                        sidebar.style.setProperty('margin-left', '0', 'important');
                        sidebar.style.setProperty('margin-right', '0', 'important');
                        
                        // Force reflow again
                        sidebar.offsetHeight;
                        
                        // Check again after a delay
                        setTimeout(() => {
                            const newTransform = window.getComputedStyle(sidebar).transform;
                            const newLeft = window.getComputedStyle(sidebar).left;
                            console.log('ğŸ” After fix - transform:', newTransform);
                            console.log('ğŸ” After fix - left:', newLeft);
                            
                            // Last resort: remove all transforms and use left only
                            if (newTransform && newTransform !== 'none' && newTransform !== 'matrix(1, 0, 0, 1, 0, 0)') {
                                console.warn('ğŸ”§ Last resort: removing transform, using left only');
                                sidebar.style.removeProperty('transform');
                                sidebar.style.setProperty('left', '0px', 'important');
                                sidebar.style.setProperty('margin-left', '0', 'important');
                            }
                        }, 50);
                    }
                }
            }, 100);
        }

        // Make function globally available
        window.toggleMobileMenu = toggleMobileMenu;

        // Close mobile menu when clicking overlay
        const overlay = document.getElementById('sidebar-overlay');
        if (overlay) {
            overlay.addEventListener('click', (e) => {
                e.stopPropagation();
                // Only close on mobile
                if (window.innerWidth <= 768) {
                    console.log('ğŸ”µ Overlay clicked, closing sidebar...');
                    toggleMobileMenu();
                }
            });
        }

        // Close mobile menu on window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                if (sidebar) sidebar.classList.remove('open');
                if (overlay) overlay.classList.remove('active');
            }
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                // Stop propagation to prevent overlay from closing menu
                e.stopPropagation();
                e.preventDefault();
                
                console.log('ğŸ”µ Navigation clicked:', item.dataset.page);
                
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
                item.classList.add('active');
                const page = item.dataset.page;
                
                const targetPage = document.getElementById(`page-${page}`);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                document.getElementById('page-title').textContent = item.textContent.trim();
                    console.log('âœ… Page switched to:', page);
                } else {
                    console.error('âŒ Page not found:', `page-${page}`);
                }
                
                // Close mobile menu after navigation
                if (window.innerWidth <= 768) {
                    console.log('ğŸ”µ Closing sidebar after navigation...');
                    toggleMobileMenu();
                }
            });
        });

        // Update current server display
        function updateServerDisplay() {
            const serverEl = document.getElementById('current-server');
            if (serverEl) {
                serverEl.textContent = `ğŸŒ ${API_BASE}`;
            }
        }

        // Switch between local and online server
        function switchServer() {
            const current = API_BASE;
            const isOnline = current.includes('103.149.252.114');
            const newUrl = isOnline ? 'http://localhost:3000' : 'http://103.149.252.114:3000';
            
            if (confirm(`Switch from ${current} to ${newUrl}?`)) {
                localStorage.setItem('apiBaseUrl', newUrl);
                window.location.reload();
            }
        }

        // Load initial data
        async function init() {
            updateServerDisplay();
            checkServerStatus();
            loadEndpoints();
            loadActivity();
            updateStats();
        }

        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const statusEl = document.getElementById('server-status');
                if (response.ok) {
                    statusEl.textContent = 'Online';
                    statusEl.className = 'status-badge status-success';
                } else {
                    throw new Error('Server error');
                }
            } catch (error) {
                const statusEl = document.getElementById('server-status');
                statusEl.textContent = 'Offline';
                statusEl.className = 'status-badge status-error';
            }
        }

        async function loadEndpoints() {
            try {
                const response = await fetch(`${API_BASE}/api`);
                const data = await response.json();
                
                if (data.endpoints) {
                    stats.total = countEndpoints(data.endpoints);
                    updateStats();
                    displayEndpoints(data.endpoints);
                    displayServerInfo(data);
                    // Auto-sync presets theo /api endpoints
                    syncPresetsFromApiEndpoints(data.endpoints);
                    renderPresetsSelect();
                    renderQuickTests();
                }
            } catch (error) {
                console.error('Failed to load endpoints:', error);
                document.getElementById('endpoints-list').innerHTML = 
                    '<div style="color: #f44336; text-align: center; padding: 20px;">Failed to load endpoints</div>';
            }
        }

        function flattenApiEndpoints(endpointsObj) {
          const out = [];
          function walk(obj, prefix = '') {
            for (const k of Object.keys(obj || {})) {
              const v = obj[k];
              if (typeof v === 'string') {
                const [method, path] = v.split(' ');
                out.push({ category: prefix || 'root', key: `${prefix}.${k}`.replace(/^\./, ''), method, path, label: `${prefix ? prefix + ' - ' : ''}${k}` });
              } else if (v && typeof v === 'object') {
                walk(v, k);
              }
            }
          }
          walk(endpointsObj, '');
          return out;
        }

        function requiresAuthByPath(path) {
          // Public endpoints
          if (path === '/api/health' || path === '/api') return false;
          // Auth endpoints are public
          if (path.startsWith('/api/auth/')) return false;
          return true;
        }

        function syncPresetsFromApiEndpoints(endpointsObj) {
          const flat = flattenApiEndpoints(endpointsObj);
          const synced = [];
          // keep basic
          synced.push({ key: 'health', name: 'Health Check', method: 'GET', path: '/api/health', requiresAuth: false });
          synced.push({ key: 'apiInfo', name: 'API Info', method: 'GET', path: '/api', requiresAuth: false });

          for (const e of flat) {
            const sig = `${e.method} ${e.path}`;
            // bá» 2 cÃ¡i public Ä‘Ã£ add á»Ÿ trÃªn Ä‘á»ƒ trÃ¡nh duplicate
            if (sig === 'GET /api/health' || sig === 'GET /api') continue;
            const preset = {
              key: `api.${e.key}`,
              name: e.label,
              method: e.method,
              path: e.path,
              requiresAuth: requiresAuthByPath(e.path)
            };

            // attach body template if match exact signature or parameterized signature
            preset.body = BODY_TEMPLATES[sig] || null;
            if (!preset.body) {
              // map param patterns
              const paramSig = sig
                .replace(/\/api\/users\/:userId/g, '/api/users/:userId')
                .replace(/\/api\/groups\/:groupId/g, '/api/groups/:groupId')
                .replace(/\/api\/message\/:messageId/g, '/api/message/:messageId')
                .replace(/\/api\/notifications\/:notificationId/g, '/api/notifications/:notificationId');
              preset.body = BODY_TEMPLATES[paramSig] || null;
            }

            // attach onSuccess hook
            preset.onSuccess = ON_SUCCESS_BY_SIG[sig] || ON_SUCCESS_BY_SIG[sig.replace(/\/api\/users\/:userId/g, '/api/users/:userId')
              .replace(/\/api\/groups\/:groupId/g, '/api/groups/:groupId')
              .replace(/\/api\/message\/:messageId/g, '/api/message/:messageId')] || null;

            // Replace :params with our variables in URL path for calling
            preset.path = preset.path
              .replace(':userId', '${USER_ID}')
              .replace(':groupId', '${GROUP_ID}')
              .replace(':messageId', '${MESSAGE_ID}')
              .replace(':notificationId', '${NOTIFICATION_ID}')
              .replace(':friendId', '${FRIEND_ID}');

            // Some endpoints include query placeholders
            preset.path = preset.path
              .replace('/api/users/search/:query', '/api/users/search/test?limit=20')
              .replace('/api/message/:roomId', '/api/message/${ROOM_ID}?limit=50&skip=0');

            synced.push(preset);
          }

          // Override global PRESETS
          PRESETS = synced;
        }

        function countEndpoints(endpoints) {
            let count = 0;
            function traverse(obj) {
                for (const key in obj) {
                    if (typeof obj[key] === 'string') {
                        count++;
                    } else if (typeof obj[key] === 'object') {
                        traverse(obj[key]);
                    }
                }
            }
            traverse(endpoints);
            return count;
        }

        function displayEndpoints(endpoints) {
            const list = document.getElementById('endpoints-list');
            list.innerHTML = '';
            
            function addEndpoint(method, path, category = '') {
                const item = document.createElement('div');
                item.className = 'endpoint-item';
                const methodClass = `method-${method.toLowerCase()}`;
                item.innerHTML = `
                    <div class="endpoint-info">
                        <span class="endpoint-method ${methodClass}">${method}</span>
                        <span class="endpoint-path">${path}</span>
                    </div>
                    <div class="endpoint-actions">
                        <button class="btn btn-secondary" onclick="testEndpoint('${method}', '${path}')">Test</button>
                    </div>
                `;
                list.appendChild(item);
            }

            function traverse(obj, prefix = '') {
                for (const key in obj) {
                    if (typeof obj[key] === 'string') {
                        const [method, path] = obj[key].split(' ');
                        addEndpoint(method, path, prefix);
                    } else if (typeof obj[key] === 'object') {
                        traverse(obj[key], key);
                    }
                }
            }

            traverse(endpoints);
        }

        function displayServerInfo(data) {
            const info = document.getElementById('server-info');
            info.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <span style="color: #4a9eff; font-size: 18px;">ğŸ“¦</span>
                    <div>
                        <strong style="color: #e0e0e0;">Version:</strong> 
                        <span style="color: #4a9eff; font-weight: 600;">${data.version || 'N/A'}</span>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <span style="color: #4a9eff; font-size: 18px;">ğŸ’¬</span>
                    <div>
                        <strong style="color: #e0e0e0;">Message:</strong> 
                        <span style="color: #aaa;">${data.message || 'N/A'}</span>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="color: #4a9eff; font-size: 18px;">ğŸŒ</span>
                    <div>
                        <strong style="color: #e0e0e0;">Base URL:</strong> 
                        <code style="background: #252525; padding: 4px 8px; border-radius: 4px; color: #4caf50; font-family: monospace;">${API_BASE}</code>
                    </div>
                </div>
            `;
        }

        function testEndpoint(method, path) {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.querySelector('[data-page="test"]').classList.add('active');
            document.getElementById('page-test').classList.remove('hidden');
            document.getElementById('page-title').textContent = 'Test API';
            
            document.getElementById('test-method').value = method;
            document.getElementById('test-url').value = `${API_BASE}${path}`;
        }

        async function handleTestSubmit(event) {
            event.preventDefault();
            stats.active++;
            updateStats();
            
            const method = document.getElementById('test-method').value;
            const url = document.getElementById('test-url').value;
            const headersText = document.getElementById('test-headers').value;
            const bodyText = document.getElementById('test-body').value;

            const headers = {
                'Content-Type': 'application/json'
            };

            if (accessToken) {
                headers['Authorization'] = `Bearer ${accessToken}`;
            }

            try {
                if (headersText) {
                    Object.assign(headers, JSON.parse(headersText));
                }
            } catch (e) {
                alert('Invalid headers JSON');
                return;
            }

            const options = {
                method: method,
                headers: headers
            };

            if (bodyText && (method === 'POST' || method === 'PUT')) {
                try {
                    options.body = bodyText;
                } catch (e) {
                    alert('Invalid body JSON');
                    return;
                }
            }

            const startTime = Date.now();
            try {
                const response = await fetch(url, options);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                let responseData;
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    responseData = await response.json();
                } else {
                    responseData = await response.text();
                }

                const responseEl = document.getElementById('test-response');
                const contentEl = document.getElementById('test-response-content');
                responseEl.style.display = 'block';
                responseEl.className = 'response-area' + (response.ok ? '' : ' error');
                contentEl.textContent = JSON.stringify(responseData, null, 2);
                
                stats.active--;
                if (response.ok) {
                    stats.success++;
                } else {
                    stats.errors++;
                }
                updateStats();

                addActivity(method, url, response.status, responseTime);
            } catch (error) {
                stats.active--;
                stats.errors++;
                updateStats();
                
                const responseEl = document.getElementById('test-response');
                const contentEl = document.getElementById('test-response-content');
                responseEl.style.display = 'block';
                responseEl.className = 'response-area error';
                contentEl.textContent = `Error: ${error.message}`;
                
                addActivity(method, url, 'ERROR', 0);
            }
        }

        function addActivity(method, url, status, time) {
            const activity = {
                method,
                url,
                status,
                time,
                timestamp: new Date().toISOString()
            };
            activityLog.unshift(activity);
            if (activityLog.length > 50) {
                activityLog = activityLog.slice(0, 50);
            }
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
            loadActivity();
        }

        function loadActivity() {
            const list = document.getElementById('activity-list');
            if (activityLog.length === 0) {
                list.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">No activity yet</div>';
                return;
            }

            list.innerHTML = activityLog.map(activity => {
                const time = new Date(activity.timestamp);
                const timeAgo = getTimeAgo(time);
                const statusClass = activity.status === 'ERROR' || activity.status >= 400 
                    ? 'status-error' 
                    : 'status-success';
                
                return `
                    <div class="activity-item">
                        <div class="activity-avatar">${activity.method.charAt(0)}</div>
                        <div class="activity-content">
                            <div><strong>${activity.method}</strong> ${activity.url}</div>
                            <div class="activity-time">${timeAgo} - <span class="status-badge ${statusClass}">${activity.status}</span> ${activity.time}ms</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            if (seconds < 60) return 'just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            const days = Math.floor(hours / 24);
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }

        function updateStats() {
            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stat-active').textContent = stats.active;
            const totalRequests = stats.success + stats.errors;
            const successRate = totalRequests > 0 ? Math.round((stats.success / totalRequests) * 100) : 0;
            document.getElementById('stat-success').textContent = successRate + '%';
            document.getElementById('stat-errors').textContent = stats.errors;
        }

        function saveSettings() {
            const baseUrl = document.getElementById('base-url').value;
            let token = document.getElementById('access-token').value || '';
            let rToken = document.getElementById('refresh-token').value || '';
            const varsText = document.getElementById('vars-json').value;

            // Normalize: cho phÃ©p user dÃ¡n cáº£ \"Bearer xxx\" nhÆ°ng mÃ¬nh chá»‰ láº¥y pháº§n token
            if (token.toLowerCase().startsWith('bearer ')) {
              token = token.slice(7).trim();
            }
            if (rToken.toLowerCase().startsWith('bearer ')) {
              rToken = rToken.slice(7).trim();
            }

            localStorage.setItem('apiBaseUrl', baseUrl);
            localStorage.setItem('accessToken', token);
            localStorage.setItem('refreshToken', rToken);
            accessToken = token;
            refreshToken = rToken;

            // Optional: save vars if JSON há»£p lá»‡
            try {
              if (varsText && varsText.trim().length > 0) {
                const v = JSON.parse(varsText);
                if (v && typeof v === 'object') {
                  vars = v;
                  saveVars();
                }
              }
            } catch (e) {
              // ignore, chá»‰ cáº£nh bÃ¡o nhá»
              console.warn('Invalid vars JSON in Settings:', e.message);
            }

            alert('Settings saved!');
        }

        // Load settings
        document.getElementById('base-url').value = API_BASE;
        document.getElementById('access-token').value = accessToken;
        document.getElementById('refresh-token').value = refreshToken;
        document.getElementById('vars-json').value = JSON.stringify(vars, null, 2);
        
        // Update server display when base URL changes
        document.getElementById('base-url').addEventListener('input', () => {
            const newUrl = document.getElementById('base-url').value;
            if (newUrl) {
                const serverEl = document.getElementById('current-server');
                if (serverEl) {
                    serverEl.textContent = `ğŸŒ ${newUrl}`;
                }
            }
        });
        
        // Update server display when settings change
        document.getElementById('base-url').addEventListener('change', () => {
            const newUrl = document.getElementById('base-url').value;
            if (newUrl !== API_BASE) {
                updateServerDisplay();
            }
        });

        // allow editing vars json
        document.getElementById('vars-json').addEventListener('change', () => {
          try {
            const v = JSON.parse(document.getElementById('vars-json').value || '{}');
            vars = v && typeof v === 'object' ? v : {};
            saveVars();
            alert('Variables saved!');
          } catch (e) {
            alert('Invalid vars JSON');
          }
        });

        // Initialize
        init();
        renderPresetsSelect();
        renderQuickTests();
        setInterval(checkServerStatus, 30000); // Check every 30 seconds
    </script>
</body>
</html>

